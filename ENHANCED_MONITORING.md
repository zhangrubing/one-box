# 增强监控系统功能说明

## 概述

本项目已经将模拟数据替换为真实数据，并增加了许多增强的监控功能。以下是详细的改进说明。

## 主要改进

### 1. 真实数据收集 ✅

**原有功能保持：**
- 使用 `psutil` 库收集真实的系统指标
- 每5秒自动采集并存储监控数据
- 支持CPU、内存、磁盘、GPU等基础监控

**新增功能：**
- 网络IO详细统计（包括错误包统计）
- 进程状态统计和TOP进程监控
- 系统负载和运行时间监控
- 更详细的GPU信息收集

### 2. 智能告警系统 🚨

**新增告警检测：**
- CPU使用率告警（>80% 警告，>90% 严重）
- 内存使用率告警（>85% 警告，>95% 严重）
- GPU温度告警（>80°C 警告，>85°C 严重）
- 磁盘IO告警（>1GB/s 警告）
- 系统负载告警（超过CPU核心数2倍）

**告警管理：**
- 自动创建告警记录
- 防重复告警（5分钟内同一告警只发送一次）
- 告警确认和删除功能
- 告警历史查询

### 3. 增强的API接口 📡

**新增API端点：**
- `/api/enhanced/system/snapshot` - 获取完整系统快照
- `/api/enhanced/network/io` - 网络IO统计
- `/api/enhanced/process/info` - 进程统计信息
- `/api/enhanced/alerts/recent` - 最近告警
- `/api/enhanced/alerts/critical` - 严重告警
- `/api/enhanced/alerts/{id}/ack` - 确认告警
- `/api/enhanced/alerts/{id}` - 删除告警

### 4. 增强的前端界面 🖥️

**新增页面：**
- `/enhanced-monitoring` - 增强监控仪表盘

**新功能：**
- 实时系统状态显示
- 网络统计信息
- 进程状态统计
- 告警管理界面
- 更丰富的图表展示

## 文件结构

```
backend/
├── utils/
│   ├── system.py                 # 增强的系统监控工具
│   ├── alert_manager.py          # 告警管理器
│   └── enhanced_system.py        # 增强系统监控（备份）
├── routers/
│   └── enhanced_monitoring.py    # 增强监控API路由
├── app.py                        # 主应用（已集成增强功能）
└── app_enhanced.py              # 增强版应用（备份）

templates/
├── enhanced_monitoring.html      # 增强监控页面
└── base_enhanced.html           # 增强版基础模板

test_enhanced_monitoring.py       # 功能测试脚本
run_enhanced.sh                   # 增强版启动脚本
```

## 使用方法

### 1. 启动增强版监控系统

```bash
# 使用增强版启动脚本
./run_enhanced.sh

# 或手动启动
source .venv/bin/activate
uvicorn backend.app:app --host 0.0.0.0 --port 8000 --reload
```

### 2. 访问增强监控页面

打开浏览器访问：`http://localhost:8000/enhanced-monitoring`

### 3. 测试功能

```bash
# 运行功能测试
python3 test_enhanced_monitoring.py
```

## 监控指标说明

### 系统指标
- **CPU使用率**: 实时CPU使用百分比
- **内存使用率**: 实时内存使用百分比
- **系统负载**: 1分钟、5分钟、15分钟平均负载
- **运行时间**: 系统启动后的运行时间
- **进程数量**: 当前运行的进程总数

### GPU指标
- **GPU利用率**: 平均GPU使用百分比
- **GPU温度**: 平均GPU温度
- **GPU数量**: 检测到的GPU数量

### 网络指标
- **接口统计**: 网络接口数量和状态
- **流量统计**: 发送/接收字节数和包数
- **错误统计**: 错误包和丢包统计

### 磁盘指标
- **磁盘IO**: 实时磁盘读写速度（MB/s）
- **磁盘使用**: 各分区的使用情况

## 告警规则

| 指标 | 警告阈值 | 严重阈值 | 说明 |
|------|----------|----------|------|
| CPU使用率 | >80% | >90% | 持续高CPU使用 |
| 内存使用率 | >85% | >95% | 内存不足风险 |
| GPU温度 | >80°C | >85°C | GPU过热风险 |
| 磁盘IO | >1GB/s | - | 磁盘性能瓶颈 |
| 系统负载 | >CPU核心数×2 | - | 系统过载 |

## 技术特点

1. **真实数据**: 完全基于系统真实指标，无模拟数据
2. **实时监控**: 支持实时数据流和WebSocket推送
3. **智能告警**: 自动检测异常并生成告警
4. **防重复**: 避免同一告警重复发送
5. **可扩展**: 模块化设计，易于添加新功能
6. **高性能**: 异步处理，低资源占用

## 注意事项

1. 确保系统已安装必要的依赖包（psutil, aiosqlite等）
2. 告警功能需要数据库支持，确保SQLite数据库正常
3. GPU监控需要nvidia-smi工具支持
4. 建议定期清理旧告警数据以保持性能

## 故障排除

如果遇到问题，可以：

1. 运行测试脚本检查功能状态
2. 查看系统日志了解错误信息
3. 检查数据库连接和权限
4. 确认系统依赖包安装完整

## 后续改进建议

1. 添加更多监控指标（如温度传感器、电源状态等）
2. 实现告警通知（邮件、短信、Webhook等）
3. 添加数据导出和报表功能
4. 支持多节点监控
5. 添加自定义告警规则配置
