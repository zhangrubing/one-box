{% extends "base.html" %}{% set page_title="存储与磁盘" %}{% block content %}
<div class="card"><div class="flex"><div class="section-title"><span>磁盘设备（物理/逻辑）</span></div><div style="margin-left:auto"><button class="btn" id="refresh">刷新</button></div></div>
<table class="table mt-3"><thead><tr><th>名称/路径</th><th>类型</th><th>大小</th><th>型号</th><th>序列号</th><th>介质</th><th>总线</th><th>挂载点</th><th>文件系统</th><th>健康</th><th>寿命</th><th>读(MB/s)</th><th>写(MB/s)</th><th>占用</th><th>队列</th></tr></thead><tbody id="devtb"></tbody></table>
</div>
<div class="card mt-4"><div class="section-title"><span>分区与挂载点</span></div>
<table class="table mt-3"><thead><tr><th>设备</th><th>挂载点</th><th>文件系统</th><th>选项</th><th>已用</th><th>可用</th><th>总计</th><th>使用率</th></tr></thead><tbody id="parttb"></tbody></table>
</div>
<script type="module">
import {apiGet,$,formatBytes} from "{{ url_for('static', path='assets/common.js') }}";
const devtb=$('#devtb'),parttb=$('#parttb');
function val(v, def='-'){ return (v===null||v===undefined||v==='')?def:v; }
async function load(){
  const r=await apiGet('/api/storage/detail');
  devtb.innerHTML=(r.devices||[]).map(d=>`<tr>
    <td>${val(d.path||d.name)}</td>
    <td>${val(d.type)}</td>
    <td>${val(d.size)}</td>
    <td>${val(d.model)}</td>
    <td>${val(d.serial)}</td>
    <td>${d.rota===0?'SSD':(d.rota===1?'HDD':'-')}</td>
    <td>${val(d.tran)}</td>
    <td>${val(d.mountpoint)}</td>
    <td>${val(d.fstype)}</td>
    <td title="POH:${d.power_on_hours??''}">${d.smart_ok===true?'OK':(d.smart_ok===false?'FAIL':'-')}</td>
    <td>${(d.life_left!=null)?(d.life_left.toFixed(0)+'%'):((d.life_used!=null)?('已用'+d.life_used.toFixed(0)+'%'):'-')}</td>
    <td>${(d.rmbs!=null)?d.rmbs.toFixed(1):'-'}</td>
    <td>${(d.wmbs!=null)?d.wmbs.toFixed(1):'-'}</td>
    <td>${(d.util_pct!=null)?d.util_pct.toFixed(1)+'%':'-'}</td>
    <td>${(d.queue!=null)?d.queue:'-'}</td>
  </tr>`).join('')||'<tr><td colspan=15>未获取到设备（可能权限限制）</td></tr>';
  parttb.innerHTML=(r.partitions||[]).map(p=>`<tr><td>${p.device}</td><td>${p.mountpoint}</td><td>${p.fstype}</td><td>${p.opts}</td><td>${formatBytes(p.used)}</td><td>${formatBytes(p.free)}</td><td>${formatBytes(p.total)}</td><td>${(p.percent??0).toFixed(1)}%</td></tr>`).join('');
}
document.getElementById('refresh').onclick=load; load();
</script>
{% endblock %}
